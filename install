#!/bin/bash  
### environment variables
# FAKE_ROOT: specifies a fake root. if empty, installs to root
# BIN_DIR: system executables
# LIB_DIR: system libraries
# CONFIG_DIR: system configuration dir
# DOC_DIR: documentation dir
# MIME_DIR: desktop entry dir
pushd $(dirname $0)

PROJECT_NAME=sodalite

# providing fallbacks
[ -z $BIN_DIR ] && BIN_DIR=/usr/bin
[ -z $DOC_DIR ] && DOC_DIR=/usr/share/doc
[ -z $DATA_DIR ] && DATA_DIR=/usr/share
[ -z $CONFIG_DIR ] && CONFIG_DIR=/etc
[ -z $LIB_DIR ] && LIB_DIR=/usr/lib
[ -z $LOG_DIR ] && LOG_DIR=/var/log
[ -z $MIME_DIR ] && MIME_DIR=/usr/share/applications
[ -z $MAN_DIR ] && MAN_DIR=/usr/share/man

# add project suffix
CONFIG_FILE=${CONFIG_DIR}/${PROJECT_NAME}.conf
LIB_DIR=${LIB_DIR}/${PROJECT_NAME}
DATA_DIR=${DATA_DIR}/${PROJECT_NAME}
DOC_DIR=${DOC_DIR}/${PROJECT_NAME}
LOG_FILE=$LOG_DIR/${PROJECT_NAME}.log

# add prefix fakeroot
FAKE_CONFIG_DIR=${FAKE_ROOT}${CONFIG_DIR}
FAKE_CONFIG_FILE=${FAKE_ROOT}/${CONFIG_FILE}
FAKE_BIN_DIR=${FAKE_ROOT}${BIN_DIR}
FAKE_LIB_DIR=${FAKE_ROOT}${LIB_DIR}
FAKE_DATA_DIR=${FAKE_ROOT}${DATA_DIR}
FAKE_DOC_DIR=${FAKE_ROOT}${DOC_DIR}
FAKE_LOG_FILE=${FAKE_ROOT}${LOG_FILE}
FAKE_MIME_DIR=${FAKE_ROOT}${MIME_DIR}
FAKE_MAN_DIR=${FAKE_ROOT}${MAN_DIR}

install -d $FAKE_LIB_DIR
cp -r sodalite/* $FAKE_LIB_DIR

install -d $FAKE_DATA_DIR
install bin/shell-integration.sh bin/shell-integration.fish $FAKE_DATA_DIR

install -d $FAKE_MIME_DIR
install -m 644 sodalite.desktop $FAKE_MIME_DIR

mkdir -p $(dirname $FAKE_LOG_FILE)
touch $FAKE_LOG_FILE && chmod 666 $FAKE_LOG_FILE

install -D -m 644 docs/sodalite.1 $FAKE_MAN_DIR/man1/sodalite.1

mkdir -p $FAKE_BIN_DIR
awk 'NR==1 {print; 
    print "DATA_DIR='"$DATA_DIR"'"; 
    print "LIB_DIR='"$LIB_DIR"'"; 
    print "LOG_FILE='"$LOG_FILE"'"; 
    print "CONFIG_FILE='"$CONFIG_FILE"'"} 
    NR!=1'  \
        bin/$PROJECT_NAME > "$FAKE_BIN_DIR/$PROJECT_NAME"
chmod 755 $FAKE_BIN_DIR/$PROJECT_NAME
install bin/sodalite-open $FAKE_BIN_DIR

mkdir -p $FAKE_CONFIG_DIR
[ -f $FAKE_CONFIG_FILE ] && mv $FAKE_CONFIG_FILE ${FAKE_CONFIG_FILE}.bak
cp docs/sodalite.conf $FAKE_CONFIG_FILE
cp docs/sodalite.conf $FAKE_DATA_DIR
