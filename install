#!/bin/bash  
### environment variables
# FAKE_ROOT: specifies a fake root. if empty, installs to root
# BIN_DIR: system executables
# LIB_DIR: system libraries
# CONFIG_DIR: system configuration dir
# DOC_DIR: documentation dir
# MIME_DIR: desktop entry dir
# MAN_DIR: manpages dir
pushd $(dirname $0) > /dev/null

PROJECT_NAME=sodalite

# providing fallbacks
[ -z $BIN_DIR ] && BIN_DIR=/usr/bin
[ -z $DOC_DIR ] && DOC_DIR=/usr/share/doc
[ -z $DATA_DIR ] && DATA_DIR=/usr/share
[ -z $CONFIG_DIR ] && CONFIG_DIR=/etc
[ -z $LIB_DIR ] && LIB_DIR=/usr/lib
[ -z $LOG_DIR ] && LOG_DIR=/var/log
[ -z $MIME_DIR ] && MIME_DIR=/usr/share/applications
[ -z $MAN_DIR ] && MAN_DIR=/usr/share/man

# add prefix fakeroot and required suffixes
CONFIG_DIR=${FAKE_ROOT}${CONFIG_DIR}
CONFIG_FILE=${CONFIG_DIR}/${PROJECT_NAME}.conf
BIN_DIR=${FAKE_ROOT}${BIN_DIR}
LIB_DIR=${FAKE_ROOT}${LIB_DIR}/${PROJECT_NAME}
DATA_DIR=${FAKE_ROOT}${DATA_DIR}/${PROJECT_NAME}
DOC_DIR=${FAKE_ROOT}${DOC_DIR}/${PROJECT_NAME}
LOG_FILE=${FAKE_ROOT}${LOG_DIR}/${PROJECT_NAME}.log
MIME_DIR=${FAKE_ROOT}${MIME_DIR}
MAN_DIR=${FAKE_ROOT}${MAN_DIR}/man1

install -d $BIN_DIR $LIB_DIR $DATA_DIR $MIME_DIR $CONFIG_DIR $DOC_DIR $MAN_DIR $(dirname $LOG_FILE)

cp -r sodalite/*  $LIB_DIR
chmod -R u+rwX,go+rwX,go-w $LIB_DIR/*

install -m 644 bin/shell-integration.sh bin/shell-integration.fish $DATA_DIR

install -m 644 sodalite.desktop $MIME_DIR

touch $LOG_FILE && chmod 666 $LOG_FILE

install -m 644 docs/sodalite.1.gz $MAN_DIR

awk 'NR==1 {print; 
    print "DATA_DIR='"$DATA_DIR"'"; 
    print "LIB_DIR='"$LIB_DIR"'"; 
    print "LOG_FILE='"$LOG_FILE"'"; 
    print "CONFIG_FILE='"$CONFIG_FILE"'"} 
    NR!=1'  \
        bin/$PROJECT_NAME > "$BIN_DIR/$PROJECT_NAME"
chmod 755 $BIN_DIR/$PROJECT_NAME
install bin/sodalite-open $BIN_DIR

install -m 644 docs/sodalite.conf $CONFIG_FILE
install -m 644 docs/sodalite.conf $DATA_DIR

install -m 644 README.md $DOC_DIR/README
install -m 644 copyright $DOC_DIR
install -m 644 changelog.md $DOC_DIR/changelog

popd > /dev/null
